<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>å››äººè”æœºæ¸¸æˆ - 4PWolvesKills</title>
  <style>
    body { margin: 0; padding: 20px; background: #111; color: white; font-family: Arial; }
    canvas { background: #000; display: block; margin: 10px 0; }
    input, button { padding: 8px; font-size: 16px; }
  </style>
</head>
<body>
  <h1>ğŸº å››äººè”æœºæ¸¸æˆ</h1>
  <h2>âœ… ç‰ˆæœ¬ï¼š2025-04-05-01</h2>
  <!-- å¤§å…ç•Œé¢ -->
  <div id="lobby">
    <p>è¾“å…¥æˆ¿é—´å·ï¼ˆ4ä½å­—æ¯/æ•°å­—ï¼‰</p>
    <input id="roomInput" type="text" placeholder="ä¾‹å¦‚ï¼šABCD" maxlength="10">
    <br><br>
    <button onclick="createRoom()">åˆ›å»ºæˆ¿é—´</button>
    <button onclick="joinRoom()">åŠ å…¥æˆ¿é—´</button>
  </div>

  <!-- æ¸¸æˆç•Œé¢ï¼ˆåŠ å…¥æˆ¿é—´åæ˜¾ç¤ºï¼‰ -->
  <div id="gameUI" style="display:none;">
    <div id="status">çŠ¶æ€ï¼šç­‰å¾…ä¸­...</div>
    <div id="playerList"></div>
    <br>
    <button onclick="leaveRoom()">é€€å‡ºæˆ¿é—´</button>
    <button id="destroyBtn" onclick="destroyRoom()" style="display:none; background:red; color:white;">
      ğŸ’¥ è§£æ•£æˆ¿é—´
    </button>
    <br><br>
    <canvas id="game" width="800" height="600"></canvas>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
  const socket = io();
  let currentRoom = '';
  let isHost = false;

  // æ˜¾ç¤ºæç¤º
  function showStatus(msg) {
    document.getElementById('status').textContent = 'çŠ¶æ€: ' + msg;
  }

  // æ˜¾ç¤ºæˆ¿é—´ä¿¡æ¯
  function renderRoom(roomData) {
    const list = document.getElementById('playerList');
    list.innerHTML = `<p>æˆ¿é—´æˆå‘˜ (${Object.keys(roomData.players).length}/4):</p>`;
    
    for (const pid in roomData.players) {
      const p = roomData.players[pid];
      const li = document.createElement('div');
      li.textContent = `${p.name} ${p.isHost ? 'ğŸ‘‘' : ''}`;
      li.style.margin = '5px 0';
      list.appendChild(li);
    }

    // æ˜¾ç¤ºâ€œè§£æ•£æˆ¿é—´â€æŒ‰é’®ï¼ˆä»…æˆ¿ä¸»ï¼‰
    const destroyBtn = document.getElementById('destroyBtn');
    destroyBtn.style.display = roomData.ownerId === socket.id ? 'block' : 'none';
  }

  // åˆ›å»ºæˆ¿é—´
  window.createRoom = function() {
    const roomId = document.getElementById('roomInput').value.trim().toUpperCase();
    if (!roomId) {
      alert('è¯·è¾“å…¥æˆ¿é—´å·ï¼');
      return;
    }
    socket.emit('create_room', roomId);
    currentRoom = roomId;
    showStatus('åˆ›å»ºæˆ¿é—´ ' + roomId);
  };

  // åŠ å…¥æˆ¿é—´
  window.joinRoom = function() {
    const roomId = document.getElementById('roomInput').value.trim().toUpperCase();
    if (!roomId) {
      alert('è¯·è¾“å…¥æˆ¿é—´å·ï¼');
      return;
    }
    socket.emit('join_room', roomId);
    currentRoom = roomId;
    showStatus('åŠ å…¥æˆ¿é—´ ' + roomId);
  };

  // é€€å‡ºæˆ¿é—´
  window.leaveRoom = function() {
    if (!currentRoom) return;
    socket.emit('leave_room', currentRoom);
    currentRoom = '';
    document.getElementById('gameUI').style.display = 'none';
    document.getElementById('lobby').style.display = 'block';
    showStatus('å·²é€€å‡ºæˆ¿é—´');
  };

  // è§£æ•£æˆ¿é—´ï¼ˆä»…æˆ¿ä¸»ï¼‰
  window.destroyRoom = function() {
    if (!currentRoom) return;
    if (!confirm('ç¡®å®šè§£æ•£æˆ¿é—´ï¼Ÿæ‰€æœ‰ç©å®¶å°†è¢«è¸¢å‡ºï¼')) return;
    socket.emit('destroy_room', currentRoom);
  };

  // ç›‘å¬æˆ¿é—´æ›´æ–°
  socket.on('room_update', (roomData) => {
    document.getElementById('lobby').style.display = 'none';
    document.getElementById('gameUI').style.display = 'block';
    renderRoom(roomData);
    // å¦‚æœæ˜¯æˆ¿ä¸»ï¼Œè®°å½•
    isHost = roomData.ownerId === socket.id;
  });

  // ç›‘å¬æˆ¿é—´è¢«è§£æ•£
  socket.on('room_destroyed', (roomId) => {
    if (currentRoom === roomId) {
      alert('æˆ¿ä¸»å·²è§£æ•£æˆ¿é—´ï¼');
      currentRoom = '';
      document.getElementById('gameUI').style.display = 'none';
      document.getElementById('lobby').style.display = 'block';
    }
  });

  socket.on('error', (msg) => {
    alert('é”™è¯¯: ' + msg);
  });
</script>
</body>
</html>